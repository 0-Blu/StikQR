name: iOS Build
on: [push, pull_request]
jobs:
  build:
    name: Build and upload StikQR
    strategy:
      fail-fast: false
      matrix:
        include:
          - os: 'macos-13'
            xcode: '15.1'
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
          
      - name: Set Up Xcode
        run: |
          sudo xcode-select -s /Applications/Xcode_${{ matrix.xcode }}.app
          xcodebuild -version
          
      - name: Build StikQR
        run: |
          xcodebuild -project StikQR.xcodeproj -scheme StikQR -sdk iphoneos -configuration Release clean archive -archivePath build/StikQR.xcarchive CODE_SIGNING_ALLOWED=NO
          
      - name: Create IPA
        run: |
          xcodebuild -exportArchive -archivePath build/StikQR.xcarchive -exportOptionsPlist ExportOptions.plist -exportPath build/IPA
          
      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS Build
          path: build/IPA/StikQR.ipa
